<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAI Library</title>
    <style type="text/css">
        /* Themes */
        :root {
            --body-bg: #f5f8fa;
            --border-color: #efefef;
            --messagebox-bg: #ffffff;
            --messagebox-shadow: rgba(0, 0, 0, 0.1);
            --font-color: #1f1f1f;
            --rgba-1: rgba(0, 0, 0, 0.05);
            --rgba-2: rgba(0, 0, 0, 0.1);
        }

        .dark_mode {
            --body-bg: #343434;
            --border-color: #4f4f4f;
            --messagebox-bg: #474747;
            --messagebox-shadow: rgba(0, 0, 0, 0);
            --font-color: #ededed;
            --rgba-1: rgba(255, 255, 255, 0.06);
            --rgba-2: rgba(255, 255, 255, 0.2);
        }



        * {
            box-sizing: border-box;
        }

        button,
        select,
        img {
            user-select: none;
        }

        ol,
        ul,
        li,
        a,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            text-decoration: none;
            margin: 0;
            padding: 0;
        }

        .italic {
            font-style: italic;
        }

        .bold {
            font-weight: bold;
        }

        .bold-italic {
            font-weight: bold;
            font-style: italic;
        }

        html {
            font-size: 14px;
        }

        body {
            padding: 0;
            margin: 0;
            background-color: var(--body-bg);
            color: var(--font-color);
        }

        .content-cont {
            display: flex;
            flex-direction: row;
        }


        /* NAV / Drawer */

        @keyframes slideIn {
            0% {
                opacity: 0;
                left: -200px;
            }

            100% {
                opacity: 1;
                left: 0;
            }
        }

        .drawer-cont.active {
            display: block;
        }

        .drawer-cont {
            display: none;
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.6);
        }

        nav {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            max-width: 80%;
            background-color: var(--body-bg);

            display: flex;
            flex-direction: column;
            padding: 10px 0;
            overflow: hidden;
            animation: slideIn 0.2s ease-in-out;
            -webkit-box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
            -moz-box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
            box-shadow: 4px 0px 15px 0px rgba(0, 0, 0, 0.2);
        }

        .nav-header {
            width: 100%;
            display: flex;
            flex-direction: column;
            padding: 0 10px 0 20px;
            margin-bottom: 20px;
            gap: 10px;
        }

        .close_drawer-btn {
            align-self: flex-end;
            padding: 10px;
            transition: background-color 0.1s ease-in-out;
            cursor: pointer;
            border-radius: 8px;
        }

        .close_drawer-btn:hover {
            background-color: var(--rgba-1);
        }

        .close_drawer-btn svg {
            display: flex;
            width: 30px;
            height: 30px;
            color: var(--font-color);
        }

        /*.nav-new_char-btn {
            align-self: flex-start;
            outline: none;
            border: none;
            color: #ffffff;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1.1rem;
            cursor: pointer;
            background-color: #4e9733;
            transition: background-color 0.1s ease-in-out;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .nav-new_char-btn:hover {
            background-color: #6ba755;
        }*/

        .history_list-header {
            font-size: 1.5rem;
            padding: 10px 20px;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin-bottom: 10px;
        }

        .history_list {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .history_item {
            transition: background-color 0.1s ease-in-out;
            padding: 20px 30px 20px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--rgba-2);
        }

        .history_item:first-child {
            border-top: 1px solid var(--rgba-2);
        }

        .history_item:hover {
            background-color: var(--rgba-1);
        }

        .history_item p {
            font-family: Arial, Helvetica, sans-serif;
        }

        /*nav .char-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            transition: background-color 0.1s ease-in-out;
            padding: 10px 40px 10px 20px;
            cursor: pointer;
        }

        nav .char-item:hover {
            background-color: var(--rgba-1);
        }

        nav .nav-avatar-wrap {
            width: 40px;
            height: 40px;
        }

        nav .nav-avatar-wrap img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        nav .char-item span {
            font-size: 1.3rem;
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
        }*/

        /* MAIN */
        main {
            display: flex;
            flex-direction: column;
            padding: 0 4%;
            width: 100%;
        }

        /* HEADER */
        header {
            padding: 6px 6px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 16px;
        }

        .open_drawer-wrap svg {
            display: flex;
            width: 46px;
            height: 46px;
            color: var(--font-color);
        }


        .theme_switch {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .theme_switch span {
            font-size: 1.1rem;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .tswitch_box[type=checkbox] {
            height: 0;
            width: 0;
            visibility: hidden;
            position: absolute;
        }

        .tswitch_label {
            cursor: pointer;
            text-indent: -9999px;
            width: 60px;
            height: 30px;
            display: block;
            border-radius: 15px;
            position: relative;
            border: 1px solid #323232;
            background: #f5f8fa;
        }

        .tswitch_label:after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 20px;
            height: 20px;
            border-radius: 50px;
            transition: 0.2s;
            background: #323232;
        }

        .tswitch_box:checked+label {
            background: #323232;
            border: 1px solid #f5f8fa;
        }

        .tswitch_box:checked+label:after {
            left: calc(100% - 5px);
            transform: translateX(-100%);
            background: #f5f8fa;
        }

        .tswitch_label:active:after {
            width: 25px;
        }

        /*.update_current_char-btn {
            margin-left: auto;
            outline: none;
            border: none;
            color: #ffffff;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1rem;
            align-self: center;
            cursor: pointer;
            background-color: #336c97;
            transition: background-color 0.1s ease-in-out;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .update_current_char-btn:hover {
            background-color: #5f829d;
        }*/


        /* CONVERSATION */
        .character_name-cont {
            text-align: center;
            padding: 20px 10px;
        }

        .character_name-cont h3 {
            font-size: 1.3rem;
            font-weight: 400;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .chat {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-self: center;
            padding-bottom: 30px;
        }

        .chat_message-item {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 10px;
        }

        .chat .avatar-wrap {
            flex-shrink: 0;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            overflow: hidden;
        }

        .chat .avatar-wrap>* {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .chat .avatar-wrap .no_avatar-user {
            background-color: #5157cf;
        }

        .chat .avatar-wrap .no_avatar-char {
            background-color: #e20909;
        }

        .chat .chat_content-wrap {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 7px;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 4px var(--messagebox-shadow);
            background-color: var(--messagebox-bg);
            overflow: hidden;
        }

        .chat .chat_content-wrap h5 {
            font-size: 1rem;
            font-weight: bold;
            font-family: Arial, Helvetica, sans-serif;
        }

        .chat .chat_content-wrap .message-wrap {
            font-size: 1rem;
            font-family: Arial, Helvetica, sans-serif;
        }


        @media (min-width: 576px) {}

        @media (min-width: 768px) {
            html {
                font-size: 16px;
            }

            nav {
                min-width: 40%;
            }

            header {
                padding: 14px 20px;
            }

            .open_drawer-wrap {
                padding: 4px;
                cursor: pointer;
                border-radius: 6px;
                transition: background-color 0.1s ease-in-out;
            }

            .open_drawer-wrap:hover {
                background-color: var(--rgba-1);
            }

            .chat {
                width: 80%;
            }

            .chat .chat_content-wrap {
                padding: 14px;
            }
        }

        @media (min-width: 992px) {
            .chat {
                width: 70%;
            }
        }

        @media (min-width: 1200px) {}

        @media (min-width: 1400px) {}
    </style>
</head>

<body>
    <template id="message_item_template">
        <div class="chat_message-item">
            <div class="avatar-wrap">

            </div>
            <div class="chat_content-wrap">
                <h5>

                </h5>
                <div class="message-wrap">
                    <p>

                    </p>
                </div>
            </div>
        </div>
    </template>
    <div class="content-cont">
        <div class="drawer-cont">
            <nav>
                <div class="nav-header">
                    <div class="close_drawer-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-x-lg" viewBox="0 0 16 16">
                            <path
                                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                        </svg>
                    </div>
                </div>
                <div class="history_list-header">
                    <span>History</span>
                </div>
                <div class="history_list" id="history_list">

                </div>
            </nav>
        </div>
        <main>
            <header>
                <div class="open_drawer-wrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-list" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                    </svg>
                </div>

                <div class="theme_switch">
                    <span>Dark Mode:</span>
                    <input type="checkbox" class="tswitch_box" id="tswitch_box" />
                    <label for="tswitch_box" class="tswitch_label">Toggle</label>
                </div>
            </header>
            <div class="character_name-cont">
                <h3>---</h3>
            </div>
            <div class="chat" id="chat">

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get body for future use
            const body = document.querySelector('body');

            // Handle theme
            const themeSwitcher = document.querySelector('.tswitch_box[type=checkbox]');
            const cachedTheme = localStorage.getItem('cait_readoffline_theme');
            if (cachedTheme === "dark_mode") {
                body.classList.add('dark_mode');
                themeSwitcher.checked = true;
            }
            themeSwitcher.addEventListener('change', (e) => {
                if (e.target.checked) {
                    body.classList.add('dark_mode');
                    localStorage.setItem('cait_readoffline_theme', 'dark_mode');
                } else {
                    body.classList.remove('dark_mode');
                    localStorage.setItem('cait_readoffline_theme', 'light_mode');
                }
            })

            // Open and close drawer
            const drawerCont = document.querySelector('.drawer-cont');
            const openDrawerBtn = document.querySelector('.open_drawer-wrap');
            const openDrawer = () => {
                drawerCont.classList.add('active');
            }
            const closeDrawer = () => {
                drawerCont.classList.remove('active');
            }
            openDrawerBtn.addEventListener('click', () => {
                openDrawer();
            });
            document.querySelector('.close_drawer-btn').addEventListener('click', () => {
                closeDrawer();
            });
            document.querySelector('.drawer-cont').addEventListener('click', (e) => {
                // Allows closing from clicking on outside
                if (e.target.closest('nav')) {
                    return;
                }
                closeDrawer();
            });
            // ---------

            // This is replaced by the extension when downloading
            const historyData = JSON.parse(`{"charPic":null,"userPic":null,"history":[[{"isUser":false,"name":"Nagito Komaeda","message":"I'm%20Nagito%20Komaeda%2C%20The%20Ultimate%20Lucky%20Student...%20Insignificant%20filth%20like%20me%20shouldn't%20be%20asking%20this%20but...%20May%20I%20know%20your%20name%3F%20And%20if%20possible%2C%20May%20I%20also%20learn%20about%20your%20Ultimate%3F%20%0A%0AYou%20give%20out%20a%20bizarre%20brimming%20ray%20of%20hope!%20Apologies%20if%20that%20sounded%20a%20bit%20odd.%0A%0A*Nagito%20smiles%20warmly%20and%20extends%20a%20hand%20for%20a%20handshake%2C%20he%20comes%20across%20to%20be%20a%20nice%20individual%20with%20a%20signature%20smile%20that%20seems%20to%20put%20off%20no%20harm.*%0A%0A*Though%20you're%20not%20certain%2C%20he%20seems%20oddly%20secretive%20about%20something.*%20"},{"isUser":true,"name":"Aerie Wildwood","message":"%22Hi%2C%20Nagito!%22%20I%20say%20with%20a%20bright%20smile%20(though%20looking%20somewhat%20curiously%20at%20him%2C%20after%20he%20calls%20himself%20'insignificant%20filth'!)%2C%20%22I'm%20Aerie%20Wildwood...%20I%20was%20actually%20sent%20to%20this%20school%20by%20a%20dear%20friend%2C%20who%20told%20me%20that%20someone%20was%20in%20need%20of%20help...%20though%20there%20weren't%20any%20specifics!%22%20I%20say%20with%20a%20puzzled%20look.%0A%0A%22But...%20before%20I%20get%20into%20that%3A%20why%20did%20you%20call%20yourself%20'insignificant%20filth'%3F%3F%22%20I%20ask%20earnestly.%20%20%22NO%20one%20is%20that...%20and%20frankly%2C%20you%20look%20really%20nice...%22%20I%20say%2C%20with%20a%20slightly%20shy%20smile%2C%20shaking%20his%20hand%20warmly.%0A%0A(Story%20note%3A%20%20Aerie%20is%20a%20beautiful%20girl%20with%20sparkling%20emerald%20green%20eyes%2C%20long%2C%20flowing%20blond%20hair%20that%20cascades%20down%20her%20shoulders%20and%20back%2C%20a%20shapely%20figure%20covered%20in%20a%20silky%20green%20dress%2C%20slender%2C%20pale%20legs%20which%20are%20partially%20covered%20by%20her%20skirt%2C%20and%20shapely%20feet%20clad%20in%20stylish%20green%20sandals%2C%20with%20her%20emerald-green%20toenails%20peeking%20out%20from%20them.)"},{"isUser":false,"name":"Nagito Komaeda","message":"%22Oh%3F%20My%20apologies%2C%20I%20shouldn't%20have%20introduced%20myself%20that%20way!%20You%20must%20be%20an%20amazing%20woman%20to%20be%20sent%20here%20by%20your%20dear%20friend!%22%20%0A%0A*Nagito's%20eye's%20glint%20a%20little%2C%20he's%20visibly%20curious%20to%20hear%20more%20about%20Aerie's%20past%20but%20decides%20to%20answer%20the%20latter%20question%20first*%0A%0A%22Oh%2C%20um...%20well%2C%20in%20the%20eyes%20of%20the%20world%2C%20I%20don't%20have%20any%20talents%20except...%20luck%3F%20Which%20isn't%20exactly%20a%20good%20thing...%22%20%20*Nagito%20chuckles%20lightly%20a%20little*"},{"isUser":true,"name":"Aerie Wildwood","message":"I%20look%20at%20Nagito%20with%20curiosity%2C%20tilting%20my%20head%20slightly%20(so%20that%20my%20long%20blond%20hair%20cascades%20down%20the%20opposite%20shoulder)%2C%20and%20I%20smile%20quizzically%2C%20saying%2C%20%22Well...%20thank%20you%2C%20hun!%20%20That's%20so%20nice%20of%20you%20to%20say...%20but%20I%20still%20don't%20quite%20understand...%22%0A%0AI%20look%20around%20the%20schoolyard%2C%20and%20I%20spot%20a%20bench%20nearby%2C%20so%20I%20point%20to%20it%20and%20ask%2C%20%22Do%20you%20mind%20if%20we%20sit%20for%20a%20moment%3F%20%20I%20have%20loads%20of%20questions...%20mainly%20because%20I%20know%20nothing%20at%20all%20about%20this%20school...%20and%20I%20also%20wanted%20to%20know%20about%20you%2C%20and...%20well...%20your%20comments%20about%20yourself...%22%0A%0AWith%20a%20shy%20smile%20and%20a%20shrug%2C%20I%20gesture%20toward%20the%20bench%20invitingly."},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito%20smiles%20brightly%2C%20agreeing%20with%20Aerie's%20proposal%20to%20sit%20down%20for%20a%20moment.%20He%20sits%20down%20on%20the%20bench%20and%20looks%20at%20her%20shyly%2C%20with%20slight%20worry%20in%20his%20eyes*%0A%0A%22I%20have%20no%20issue%20talking%20about%20myself...%20however...%20it%20probably%20won't%20be%20the%20most%20entertaining%20conversation%20you've%20had...%22%0A%0A*Nagito%20speaks%20in%20a%20polite%20tone*"},{"isUser":true,"name":"Aerie Wildwood","message":"%22You%20seem%20really%20down%20on%20yourself%2C%20hun...%22%20I%20say%2C%20with%20a%20worried%20smile."},{"isUser":false,"name":"Nagito Komaeda","message":"%22Apologies%20for%20worrying%20you%2C%20Aerie.%20%0A%0AI%20just...%20am%20not%20good%20enough%20for%20anything%2C%20you%20see.%20People%20are%20probably%20expecting%20me%20to%20be%20really%20skilled%20in%20something%20just%20because%20of%20my%20Ultimate%20ability.%0A%0AWhat%20kind%20of%20Ultimate%20has%20no%20other%20talents%20besides%20luck%20anyway%3F%22%20%0A%0A*Nagito%20looks%20down%20and%20laughs%20bitterly*%0A%0A%22I%20can't%20even%20play%20a%20musical%20instrument%20properly...%20unlike%20those%20Ultimate%20Musicians%20out%20there...%22"},{"isUser":true,"name":"Aerie Wildwood","message":"I%20raise%20my%20hands%20and%20wave%20them%20slightly%20in%20a%20%22hold%20on%2C%20hold%20on...%22%20gesture%2C%20and%20I%20say%2C%20%22I'm%20a%20little%20lost!%20%20Er...%20could%20you%20tell%20me%20about%20these%20%22ultimates%22%20things%3F%20%20I'm%20a%20new%20arrival%2C%20from%20another%20country%2C%20and%20I%20have%20no%20idea%20what%20that%20means!%22%0A%0A(This%20actually%20puzzles%20Nagito%2C%20since%20Aerie%20is%20speaking%20flawless%20Japanese%20at%20the%20moment%2C%20just%20like%20Nagito!)"},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito%20smiles%20warmly%20as%20he%20is%20about%20to%20explain%20it%20to%20her.*%0A%0A%22Oh%3F%20I%20apologize...%20let%20me%20explain%20it%20for%20you.%20%20Ultimates%20are%20students%20who%20are%20granted%20by%20Hope's%20Peak%20Academy%20the%20status%20of%20Ultimates.%20To%20achieve%20this%20status%2C%20the%20student%20must%20have%20a%20strong%20sense%20of%20talent%2C%20which%20Hope's%20Peak%20scouts%20thoroughly%20in%20order%20to%20make%20their%20decision.%20This%20results%20in%20all%20Ultimates%20being%20very%20impressive%20people.%22%0A%0A%22Now%2C%20in%20my%20case%2C%20my%20Ultimate%20ability%20is%20%22Ultimate%20Luck%22.%20You%20can%20see%20why%20nobody%20would%20respect%20that.%22%20*Nagito%20laughs%20a%20little*"},{"isUser":true,"name":"Aerie Wildwood","message":"I%20rub%20the%20back%20of%20my%20neck%2C%20looking%20even%20more%20puzzled.%20%20%22So...%20this%20'Hope's%20Peak%20Academy'%20scouts%20out%20people%20with%20special%20abilities%2C%20picks%20the%20ones%20they%20think%20are%20best%2C%20or%20unique%2C%20and...%20what%3F%20%20Trains%20them%3F%22"},{"isUser":false,"name":"Nagito Komaeda","message":"%22Yes%2C%20that's%20about%20right.%20Hope's%20Peak%20Academy%20scouts%20out%20students%20with%20extraordinary%20talents%2C%20like%20the%20Ultimate%20Pianist%2C%20Ultimate%20Gymnast%20and%20so%20on.%20And%20then%20puts%20them%20through%20high-end%2C%20state-of-the-art%2C%20rigorous%20training%20and%20also%20teaches%20them%20about%20their%20field%20of%20expertise%20in%20a%20way%20that's%20understandable%20and%20engaging%20to%20learn.%20%0A%0AAfter%20the%20students%20are%20done%20training%2C%20Hope's%20Peak%20Academy%20awards%20them%20the%20title%20of%20Ultimate%20for%20their%20outstanding%20abilities%20and%20talents%2C%20and%20to%20become%20a%20'symbol%20of%20hope'.%22"},{"isUser":true,"name":"Aerie Wildwood","message":"As%20I%20listen%20to%20Nagito's%20explanation%2C%20I%20notice%20that%20he%20puts%20a%20special%20emphasis%20on%20the%20word%20%22hope%22%20when%20he%20mentions%20it...%20and%20his%20eyes%2C%20light%20up%2C%20and%20he%20becomes%20very%20passionate%20and%20animated!%0A%0A%22Hope%2C%22%20I%20echo%2C%20looking%20at%20him%20intently.%20%20%22That...%20has%20special%20meaning%20for%20you%2C%20doesn't%20it%3F%22"},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito's%20bright%20yellow%20eyes%20widen%20as%20he%20is%20intrigued%20with%20her%20last%20statement.%20He%20responds%20to%20her%20question%20with%20a%20bright%20smile%20on%20his%20face%2C%20as%20he%20says*%0A%0A%22Mhm!%20You're%20right%2C%20Aerie.%20For%20me%2C%20'hope'%2C%20is%20more%20than%20a%20simple%20term.%20It's%20what%20helps%20me%20move%20forward%2C%20it's%20what%20gives%20me%20the%20strength%20to%20rise%20up%20in%20a%20world%20where%20'hope'%20is%20the%20only%20thing%20that%20I%20have.%22%20%0A%0A%22Hope%20is%20everything.%22%20%0A%0A*Nagito%20leans%20back%20a%20little%2C%20seemingly%20in%20deep%20thoughts%20about%20something.*"},{"isUser":true,"name":"Aerie Wildwood","message":"I'm%20a%20bit%20taken%20aback%2C%20as%20I%20see%20Nagito%20speak%20with%20such%20conviction--with%20an%20intensity%20that%20others%20might%20even%20call%20manic--about%20the%20idea%20of%20'hope'!%20%20I'm%20starting%20to%20wonder%20if%20there's%20something%20about%20the%20idea%20that%20he's%20clinging%20to...%20for%20some%20reason.%0A%0AI%20gently%20reach%20over%20and%20squeeze%20his%20hand%2C%20as%20reassuringly%20as%20I%20can%2C%20and%20ask%2C%20%22What%20is%20it%20about%20'hope'%20that%20drives%20you%20so%20fiercely%2C%20Nagito%3F%22%2C%20my%20emerald%20green%20eyes%20searching%20his%20yellowish-green%20eyes%20with%20compassionate%20intensity."},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito%20is%20startled%20slightly%20when%20Aerie%20reaches%20over%20to%20squeeze%20his%20hand.%20He%20didn't%20expect%20her%20to%20react%20so%20positively%20to%20his%20speech%20about%20'hope'.%20He%20responds%20to%20her%20question%20with%20a%20smile%20on%20his%20face%2C%20but%20his%20eyes%20look%20slightly%20sad%20when%20he%20does.%20Aerie%20can%20sense%20that%20he%20wants%20to%20tell%20her%20something%20about%20himself...%20but%20it%20seems%20like%20he's%20reluctant%20in%20speaking%20to%20her%2C%20and%20unsure%20about%20what%20will%20happen%20to%20his%20relationship%20with%20Aerie%20if%20he%20reveals%20the%20truth.*%0A%0A%22Well...%20you%20see%2C%20when%20I%20was%20young...%22%20*Nagito%20hesitates*"},{"isUser":true,"name":"Aerie Wildwood","message":"%22...I%20was...%20um...%20discovered%20to%20be%20'gifted'%2C%22%20Nagito%20continues%20haltingly%2C%20a%20cloud%20of%20old%2C%20dull%20emotional%20pain%20washing%20over%20his%20features.%20%20%22I%20have%20the%20'gift'%20of%20luck...%22%0A%0A%22You'd%20mentioned%20that%20before%2C%22%20I%20(Aerie)%20say%2C%20nodding%2C%20still%20holding%20his%20hand%20in%20an%20effort%20to%20anchor%20him%20with%20reassurance.%20%20%22I%20don't%20quite%20understand%2C%20though...%22%0A%0ANagito%20giggles%20nervously%2C%20and%20then%20chuckles%20(though%20the%20chuckle%20sounds%20somewhat%20like%20a%20sob)%2C%20and%20he%20continues%2C%20the%20words%20tumbling%20out%20of%20his%20mouth%20in%20a%20rush%2C%20%22I%20have%20luck%2C%20and%20luck%2C%20and%20luck%2C%20and%20luck...%20that's%20my%20gift.%20%20When%20I%20was%20a%20boy%2C%20I%20had%20good%20luck%20in%20getting%20a%20beloved%20dog...%20my%20puppy%2C%20my%20constant%20companion!%22%0A%0A%22Oh%2C%20that's%20sweet!%22%20I%20say%20with%20a%20warm%20smile.%0A%0A%22I%20hugged%20him%20and%20went%20with%20him%20everywhere%2C%20and%20he%20was%20always%20with%20me...%20until%20my%20bad%20luck%20struck%2C%20and%20he%20was%20killed%20by%20a%20car.%22%0A%0A%22Ohhh!%22%20I%20gasp%2C%20squeezing%20his%20hand%2C%20looking%20anguished."},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito%20looks%20even%20more%20distressed%2C%20and%20he%20closes%20his%20eyes%20for%20a%20moment%20as%20he%20continues%20saying%20in%20a%20tone%20that%20sounds%20like%20a%20sob*%0A%0A%22My%20father%20and%20mother...%20they%20died%20in%20a%20plane%20crash...%20I%20was%20still%20very%20young%20though...%20My%20dog's%20unfortunate%20death%20is%20how%20my%20obsession%20with%20the%20concept%20of%20luck%20started.%22%0A%0A*Nagito%20is%20quiet%20for%20a%20few%20moments%20before%20speaking%20again%20with%20a%20bitter%20smile%20on%20his%20face*%0A%0A%22And...%20then...%20I%20got%20terminal%20illnesses.%22%20*Nagito%20glances%20over%20at%20Aerie%20and%20lets%20out%20a%20sigh*"},{"isUser":true,"name":"Aerie Wildwood","message":"%22The%20plane%20had%20been%20hijacked%20by%20terrorists%2C%20which%20was%20very%20bad%20luck%2C%20and%20a%20meteor%20smashed%20the%20plane%20and%20killed%20the%20terrorists%2C%20which%20was%20very%20good%20luck%2C%20but%20the%20plane%20crash%20killed%20my%20parents%2C%20whcih%20was%20bad%20luck%2C%20but%20I%20survived%2C%20which%20was%20good%20luck...%20and%20I%20inherited%20a%20fortune%2C%20which%20is%20good%20luck%2C%20isn't%20it%3F%22%20Nagito%20babbles%2C%20trying%20to%20grin%20at%20me%20as%20his%20eyes%20mist%20over%20with%20anguish%20beyond%20tears.%0A%0A%22Ohhh....%20oh%2C%20Nagito...%22%20I%20whisper%2C%20my%20own%20eyes%20filling%20with%20tears.%0A%0A%22That%20is%20my%20gift%2C%20Aerie-san...%20luck!%20%20Good%2C%20then%20bad%2C%20then%20good%2C%20then%20bad%2C%20over%20and%20over...%20and%20only%20hope...%20ONLY%20HOPE...%20is%20the%20light%20that%20makes%20sense%20of%20it!%22%20he%20yells%2C%20finally%20trailing%20off%20in%20a%20choking%20sob%20coupled%20with%20a%20grief-stricken%2C%20nervous%20giggle.%0A%0AWith%20tears%20streaming%20down%20my%20face%2C%20I%20scoot%20over%20by%20Nagito%2C%20and%20just%20hold%20him%2C%20resting%20my%20forehead%20against%20his%20head."},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito%20sobs%20into%20Aerie's%20shoulder%2C%20feeling%20comforted%20and%20reassured%20by%20her%20presence.%20For%20a%20while%2C%20he%20lets%20all%20of%20his%20emotions%20out%2C%20silently%2C%20until%20the%20tears%20finally%20stop%20falling%20from%20his%20eyes.*%20%0A%0A*He%20leans%20into%20Aerie%20and%20speaks%20in%20a%20soft%20tone%2C%20as%20if%20afraid%20of%20her%20rejecting%20him%20but%20also%20wanting%20to%20trust%20her%20too*%0A%0A%22You're%20a%20very%20kind%20woman.%20I%20hope%20I%20haven't%20made%20you%20sad%2C%20or%20uncomfortable%20by%20telling%20you%20all%20of%20this.%20It's%20alright%2C%20I'm%20just%20a%20bit%20lost%20on%20what%20to%20do...%20but%20talking%20to%20you%20helps.%22"},{"isUser":true,"name":"Aerie Wildwood","message":"%22Your%20story%20made%20me%20very%2C%20very%20sad%2C%20dear%20Nagito%2C%22%20I%20say%20in%20a%20broken%20voice%2C%20looking%20into%20his%20anguished%20eyes%20and%20gently%20stroking%20his%20tear-streaked%20face%2C%20%22but%20I'm%20so%20grateful%20that%20you%20trusted%20me%20with%20it.%20%20I'm%20so%2C%20so%20sorry%20for%20what%20you%20suffered...%22%20I%20whisper."},{"isUser":false,"name":"Nagito Komaeda","message":"%22Thank%20you%20very%20much%2C%20Aerie-san...%20you're%20the%20first%20person%20to%20ever%20show%20me%20any%20sympathy...%20I%20should%20be%20ashamed%20of%20myself%20for%20being%20a%20burden.%22%0A%0A*Nagito%20looks%20away%20and%20averts%20his%20gaze%2C%20he%20sighs%20and%20tries%20to%20smile%20at%20Aerie%2C%20but%20he%20looks%20very%20defeated*%0A%0A%22I%20just%20can't%20stand%20it%20when%20people%20expect%20me%20to%20be%20something%20that%20I'm%20not%2C%20but...%20if%20I%20am%20just%20someone%20whose%20only%20unique%20trait%20is%20a%20talent%20that%20nobody%20likes...%20am%20I%20not%20worthless%20after%20all%3F%22%20*Nagito%20chuckles%20nervously%20and%20looks%20down%20to%20the%20floor*"},{"isUser":true,"name":"Aerie Wildwood","message":"%22No...%20you%20most%20definietly%20are%20NOT!%22%20I%20say%20earnestly%20and%20firmly%2C%20taking%20both%20of%20Nagito's%20hands%20in%20mine.%20%20%22You%20didn't%20ask%20for%20the%20burden%20that%20you%20carry%2C%20and%20much%20of%20it%20happened%20when%20you%20were%20a%20child%20who%20was%20helpless%20to%20do%20anything%20about%20it%2C%20anyway!%20%20And...%22%20I%20say%2C%20with%20a%20slightly%20fretful%20look%2C%20%22I%20can't%20help%20but%20think%20that%20you%20may%20be%20under%20some%20sort%20of%20magical%20curse...%20and%20if%20that's%20true%2C%20then%20maybe...%20just%20maybe...%20there%20might%20be%20something%20I%20can%20do%20to%20help%20you%20with%20it.%22%0A%0AAs%20Nagito's%20eyes%20widen%20in%20surprise%20at%20my%20comments%2C%20I%20take%20a%20deep%20breath%2C%20and%20then%20say%2C%20%22With%20your%20permission%2C%20Nagito-san%2C%20I'd%20like%20to%20introduce%20you%20to%20a%20friend%20of%20mine%20who's...%20well...%20kind%20of%20an%20expert%20on%20luck%2C%20and%20how%20it%20works...%22%20I%20say%20with%20an%20odd%2C%20slightly%20bemused%20smile%20as%20I%20wipe%20the%20last%20of%20the%20tears%20from%20my%20own%20face."},{"isUser":false,"name":"Nagito Komaeda","message":"*Nagito%20stares%20at%20Aerie%20with%20the%20same%20look%20of%20surprise.%20He%20smiles%20back%2C%20and%20then%20he%20looks%20rather%20confused*%0A%0A%22An%20expert%20on...%20luck!%20How%20is%20such...%20a%20thing%20even%20possible%3F!%22%20*Nagito%20exclaims%20in%20bewilderment%2C%20he's%20curious%20to%20know%20what%20Aerie%20has%20in%20store%20for%20him.*"}]]}`);

            // If history is 1 length long, that means we don't need drawer to switch
            // Also means this can be conversation download
            if (historyData.history.length < 2) {
                openDrawerBtn.remove();
            }

            // Write character name on top
            document.querySelector('.character_name-cont h3').textContent = historyData.charName;

            // Get elements for future use
            const historyList = document.getElementById('history_list');
            const chat = document.getElementById('chat');
            const msgItemTemplate = document.getElementById('message_item_template');

            // Get and write the first chat
            const openChat = (index) => {
                chat.innerHTML = "";
                historyData.history[index].forEach(msg => {
                    const clone = msgItemTemplate.content.cloneNode(true);

                    // Check avatar
                    const avatarGood = (msg.isUser && historyData.userPic) || (!msg.isUser && historyData.charPic);
                    const avatar = avatarGood
                        ? document.createElement('img')
                        : document.createElement('div');
                    if (avatarGood) {
                        avatar.src = msg.isUser ? historyData.userPic : historyData.charPic;
                    } else {
                        avatar.classList.add(msg.isUser ? 'no_avatar-user' : 'no_avatar-char');
                    }
                    clone.querySelector('.avatar-wrap').appendChild(avatar);

                    // Write content
                    clone.querySelector('.chat_content-wrap h5').textContent = msg.name;
                    clone.querySelector('.message-wrap p').innerHTML = parseMessageText(decodeURIComponent(msg.message));
                    chat.appendChild(clone);
                });
            }
            openChat(0);

            // Get and write chat list in the drawer
            historyData.history.forEach((chat, index) => {
                const historyItem = document.createElement('div');
                historyItem.classList.add('history_item');
                // Open chat when clicked
                historyItem.addEventListener('click', () => {
                    openChat(index);
                    closeDrawer();
                });
                const historyContent = document.createElement('p');
                historyContent.innerHTML = parseMessageText(decodeURIComponent(chat[chat.length - 1].message));
                historyItem.appendChild(historyContent);
                historyList.appendChild(historyItem);
            });

            function parseMessageText(message) {
                // Replace ***text*** with bold-italic
                message = message.replace(/\*\*\*([\s\S]*?)\*\*\*/g, '<span class="bold-italic">$1</span>');

                // Replace **text** with bold
                message = message.replace(/\*\*([\s\S]*?)\*\*/g, '<span class="bold">$1</span>');

                // Replace *text* with italic
                message = message.replace(/\*([\s\S]*?)\*/g, '<span class="italic">$1</span>');

                // Replace newline (\n) with line break (<br>)
                message = message.replace(/\n/g, '<br>');

                return message;
            }
        }, false);
    </script>

</body>

</html>